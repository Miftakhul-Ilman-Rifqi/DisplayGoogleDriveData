<!DOCTYPE html>
<html>
<head>
    <title>Tambun - Penerimaan</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Tambun - Penerimaan</h1>
        <h1>Daftar File di Google Drive</h1>
        <ul id="fileList"></ul>

        <script>
            var apiKey = "AIzaSyAOBoZHUrCLxlJ_hZ8Igq3gzJDIXm-1Jog";
            var folderId = "1gByKBXrq29zM7-meOp9P4hkRq61l-E7I";
            var apiUrl = "https://www.googleapis.com/drive/v3/files?q='" + folderId + "'+in+parents&key=" + apiKey;

            function loadFileList() {
                $.ajax({
                    url: apiUrl,
                    dataType: "json",
                    success: function(data) {
                        var fileList = data.files;
                        var fileListElement = document.getElementById("fileList");

                        for (var i = 0; i < fileList.length; i++) {
                            var file = fileList[i];
                            var listItem = document.createElement("li");
                            listItem.innerHTML = file.name;
                            listItem.addEventListener("click", function() {
                                var fileId = this.getAttribute("data-file-id");
                                openFileInNewTab(fileId, file.mimeType);
                            });
                            listItem.setAttribute("data-file-id", file.id);
                            fileListElement.appendChild(listItem);
                        }
                    }
                });
            }

            function openFileInNewTab(fileId, mimeType) {
                var viewerUrl = "https://drive.google.com/viewerng/viewer?embedded=true&url=";
                var fileUrl = "https://www.googleapis.com/drive/v3/files/" + fileId + "?key=" + apiKey + "&alt=media";
                var targetUrl = viewerUrl + encodeURIComponent(fileUrl);

                if (mimeType.includes("spreadsheet")) {
                    window.open("https://docs.google.com/spreadsheets/d/" + fileId, "_blank");
                } else if (mimeType.includes("document")) {
                    window.open("https://docs.google.com/document/d/" + fileId, "_blank");
                } else {
                    window.open(targetUrl, "_blank");
                }
            }

            window.onload = loadFileList;
        </script>
    </div>
</body>
</html>
